//Necesita correcciones
//Ya se puede seleccionar el led
//Falta el brillo del led
#include <Arduino.h>
#include <driver/ledc.h>

const int rchannel = 0;
const int vchannel = 1;
const int bchannel = 2;
const int freqPWM = 5000;
const int resolucion = 8;
const int ledRojo = 13;
const int ledVerde = 21;
const int ledAzul = 5;
const int botselec = 14;
const int botbrillo = 25;
const int debounceDelay = 50;
void configurar(void);
unsigned long lastDebounceTime1 = 0;
unsigned long lastDebounceTime2 = 0;
bool lastButtonState1 = HIGH;
bool lastButtonState2 = HIGH;
bool buttonState1 = HIGH;
bool buttonState2 = HIGH;
int contador = 0;
int brillo = 0;

void setup() {
  configurar();
  pinMode(botselec, INPUT_PULLUP);
  pinMode(botbrillo, INPUT_PULLUP);
}

void loop() {
  int reading1 = digitalRead(botselec);
  int reading2 = digitalRead(botbrillo);
  // Button debouncing for color selection
  if ((millis() - lastDebounceTime1) > debounceDelay) {
    if (reading1 != buttonState1) {
      buttonState1 = reading1;
      if (buttonState1 == LOW) {
        contador = (contador + 1) % 3;
      }
    }
  }
  // Button debouncing for brightness adjustment
  if ((millis() - lastDebounceTime2) > debounceDelay) {
    if (reading2 != buttonState2) {
      buttonState2 = reading2;
      if (buttonState2 == LOW) {
        brillo += 10;
        if (brillo > 255) {
          brillo = 0;
        }
      }
    }
  }
  switch (contador) {
    case 0: // Rojo
      ledcWrite(rchannel, brillo);
      ledcWrite(vchannel, 0);
      ledcWrite(bchannel, 0);
      break;
    case 1: // Verde
      ledcWrite(rchannel, 0);
      ledcWrite(vchannel, brillo);
      ledcWrite(bchannel, 0);
      break;
    case 2: // Azul
      ledcWrite(rchannel, 0);
      ledcWrite(vchannel, 0);
      ledcWrite(bchannel, brillo);
      break;
  }
}

void configurar() {
  ledcSetup(rchannel, freqPWM, resolucion);
  ledcSetup(vchannel, freqPWM, resolucion);
  ledcSetup(bchannel, freqPWM, resolucion);

  ledcAttachPin(ledRojo, rchannel);
  ledcAttachPin(ledVerde, vchannel);
  ledcAttachPin(ledAzul, bchannel);
}